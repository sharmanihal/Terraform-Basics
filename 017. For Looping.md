
### **Loops in Terraform (`for_each`)**

`for_each` is used to **create multiple resources dynamically** from a list or map of values.

---

#### **Example with a List**

```hcl
variable "bucket_names" {
  description = "List of bucket names"
  type        = list(string)
  default     = ["main", "backup", "dev"]
}

resource "aws_s3_bucket" "app_image_buckets" {
  for_each = toset(var.bucket_names)

  bucket = "2025712712-app-image-bucket-${each.value}"
}
```

✅ **Explanation:**

* `toset()` converts the list to a set (removes duplicates).
* `for_each` iterates over each element of the set.
* `each.value` gives the current item (e.g., `"main"`, `"backup"`, `"dev"`).

---

#### **Result**

Terraform will create **3 separate S3 buckets**:

```
2025712712-app-image-bucket-main
2025712712-app-image-bucket-backup
2025712712-app-image-bucket-dev
```

---

#### **Example with a Map**

```hcl
variable "servers" {
  type = map(string)
  default = {
    frontend = "t2.micro"
    backend  = "t2.small"
  }
}

resource "aws_instance" "servers" {
  for_each = var.servers

  ami           = "ami-123456"
  instance_type = each.value
  tags = {
    Name = each.key
  }
}
```

✅ **Explanation:**

* `each.key` → `"frontend"`, `"backend"`
* `each.value` → `"t2.micro"`, `"t2.small"`

Terraform will create **two EC2 instances**:

* One tagged `frontend` (t2.micro)
* One tagged `backend` (t2.small)

---

**Summary:**

| Data Type | Use                         | Access                   |
| --------- | --------------------------- | ------------------------ |
| List/Set  | Use `toset()` for iteration | `each.value`             |
| Map       | Directly use `var.map_name` | `each.key`, `each.value` |

